<!DOCTYPE html>
<html>
<head>
	<meta content="text/html; charset=utf-8" http-equiv="content-type">
	<title>xBENCH</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css" />
	<!--[if lt IE 9]>    
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.ie.min.css" />
	<![endif]-->
	
	<style>
	
.blinking-cursor { /*https://codepen.io/ArtemGordinsky/pen/GnLBq*/
font-weight: 100;
font-size: 30px;
color: white;
-webkit-animation: 1s blink step-end infinite;
-moz-animation: 1s blink step-end infinite;
-ms-animation: 1s blink step-end infinite;
-o-animation: 1s blink step-end infinite;
animation: 1s blink step-end infinite;
}
@keyframes "blink" {
	from, to {
color: transparent;
}
 50% {
color: white;
}

}

@-moz-keyframes blink {

from, to {
 color: transparent;
 }
50% {

color: white;

}}
@-webkit-keyframes blink {

from, to {
 color: transparent;
 }
50% {

color: white;

}}@-ms-keyframes blink {

from, to {
 color: transparent;
 }
50% {

color: white;

}}@-o-keyframes blink {

from, to {
 color: transparent;
 }
50% {

color: white;

}}
	  html,body {
	   height: 100%
	   width: 100%;
	   overflow: scroll;
	   
	}
	a, a.visited {
	color:white;
	  text-decoration:none;
	  font-style: italic;
	  border:0;
	  
	}
	
	body {
	   font-family:arial;
	   margin:0;
	   background:#f2f2f2;
	}
	.banner {
	   background: #6424b3;
	   height: 15%;
	   top: 0;
	   width: 100%;
	   box-shadow: 0px 0.5vh 1vh 0px rgba(0,0,0,0.75);
	}
	.big_text {
	   font-size: 7vh;
	   color: white;
	   margin: auto;
	   padding: auto;
	   font-weight: bold;
	   vertical-align: center;
	   align: center;

	}
	.content {
	   background: #000;
	   line-height: 2vh;
	   margin: 10% 5% 5% 5%;
	   box-shadow: 0px 0.5vh 1vh 0px rgba(0,0,0,0.75);
	   padding: 1vh 1vh 1vh 1vh;
	   font-size: 2vh;
	   color:white;
	  
	   
	}
	.button {
	   bottom: 2vh;
	   right: 2vh;
	   position: fixed;
	   background-color: #555555;
	   height: 12vh;
	   width: 12vh;
	   box-shadow: 0px 0.5vh 1vh 0px rgba(0,0,0,0.75);
	   border: none;
	   border-radius: 50%;
	   object-fit: cover;

	}
	</style>
	<script src="gl-matrix.js" type="text/javascript"></script>

	<script type="text/javascript">
var go = true;
function log(html) {
	document.getElementById('logDiv').innerHTML += '<br/>' + html ;
	
}


var runCount = 10;
var internalRunCount = 2000000;



	           function test(name, f) {
	               // Repeats each benchmark multiple times to smooth out anomalies
	               // Also tracks min and max times

	               if(!f) {
	                   log('<i>' + name + ': Unsupported<\/i>');
	                   return;
	               }


	               var totalTime = 0;
	               var minTime = 0;
	               var maxTime = 0;

	               for(var i = 0; i < runCount; ++i) {
	                   var time = f(internalRunCount);
	                   if(i == 0) {
	                       minTime = time;
	                       maxTime = time;
	                   } else {
	                       if(minTime > time) { minTime = time; }
	                       if(maxTime < time) { maxTime = time; }
	                   }
	                   totalTime += time;
	               }

	               var avg_u = totalTime / runCount;
                   var avg=avg_u.toFixed(2);
	               log('<i>' + name + '<\/i> - avg: <b>' + avg + 'ms<\/b>, min: ' + minTime + 'ms, max: ' + maxTime + 'ms');
				   log("<br/>benchmark done.");

	           }

	           function testSet(name, tests) {
	               setTimeout(function() {
	                   for(var i = 0; i < tests.length; ++i) {
	                       test(tests[i].name, tests[i].test);
	                   }
	               }, 1);
	           }

	           function glMatrixRandom() {
	               return mat4.create([
	                   Math.random()*100, Math.random()*100, Math.random()*100, Math.random()*100,
	                   Math.random()*100, Math.random()*100, Math.random()*100, Math.random()*100,
	                   Math.random()*100, Math.random()*100, Math.random()*100, Math.random()*100,
	                   Math.random()*100, Math.random()*100, Math.random()*100, Math.random()*100
	               ]);
	           }
	           function testGPU() {
	               var canvas = document.createElement('canvas');
	               var gl;
	               var debugInfo;
	               var vendor;
	               var renderer;

	               try {
	                 gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
	               } catch (e) {
	               }

	               if (gl) {
	                 debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
	                 vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
	                 renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
	               }
	               log("<br/><u>testing GPU:</u> "+renderer);

	               testSet('Multiplication', [
	                   { name: '<a href=https://github.com/mortennobel/glMatrix-vs-GLM-Benchmark>gl-Matrix</a>', test: function(count) {
	                       var m1 = glMatrixRandom();
	                       var m2 = glMatrixRandom();
	                       var res = glMatrixRandom();
	                       var start = Date.now();
	                       for (var i = 0; i < count; ++i) {
	                           mat4.multiply(res, m1, m2);
	                       }
	                       return Date.now()-start;
	                   }}
	               ]);
	
			   }
	           function testCPU() {
					var cores = window.navigator.hardwareConcurrency;
					log("<br/><u>testing CPU:</u> ("+ cores +" cores)");
					var min_runtime=9007199254740991;
					var max_runtime=1;
					var avg_runtime=0;
					var avg_count= 0;
					var old_runtime=0;
					for (cpu=0;cpu<runCount;cpu++){
					   var d = new Date();
					   var amount = 990000000;
					   for (var i = amount; i>0; i--) {} 
					   var newd = new Date();
					   var accnewd = Number(String(newd.getSeconds())+"."+String(newd.getMilliseconds()));
					   var accd = Number(String(d.getSeconds())+"."+String(d.getMilliseconds())); 
					   var di = accnewd-accd;
					   //console.log(accnewd,accd,di);
					   if (d.getMinutes() != newd.getMinutes()){di = (60*(newd.getMinutes()-d.getMinutes()))+di}
					   var runtime = Math.round(di*1000);
					   if(runtime>0){
					       if(cpu==0){
						     min_runtime=runtime;
							 max_runtime=runtime;
						   }else{
						     if(runtime>max_runtime){
							   max_runtime=runtime;
							   avg_runtime=avg_runtime + runtime;
						       avg_count++;
							  }else{
							    if(runtime<min_runtime){
								   min_runtime=runtime;
								   avg_runtime=avg_runtime + runtime;
						           avg_count++;
								 }
							  }
						   }
					   }
					  
					   
				   }
				   avg_runtime = avg_runtime /avg_count;
	               log("<a href='https://stackoverflow.com/a/42143572'>JSBenchmark</a> - avg: <b>"+avg_runtime+"ms</b>");			   
					testGPU();
			   }



//https://stackoverflow.com/a/33414145
function wait(ms){
   var start = new Date().getTime();
   var end = start;
   while(end < start + ms) {
     end = new Date().getTime();
  }
}			   

			   function start(){
			       if(go){
			       go =false;
				   log("benchmark initialized...");
				   log("system (user-agent): " + navigator.userAgent);
				   
				   wait(500);
				   testCPU();
				   wait(500);}

			   }
			   

	</script>
</head>
<body>
  <a class="github-fork-ribbon" href="https://github.com/wegeneredv-de/xBENCH" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
  <div class="banner">
	  <span class="big_text"><a href="https://git.io/vF9K6">xBENCH</a></span>
	</div>
	<div class="content">
		<div id="logDiv">
			<center>
			<a href="https://git.io/vF9K6">crossplatform BENCHMARK</a><sup>beta</sup><br/><br/>
			</center>
- lower avg values are better<br/>
			- runs on any platform that runs <a href="https://www.chromium.org/">chrome</a> w/ webgl support<br/>
- online comparism chart will be added in next update<br/>
		
		</div><div class="blinking-cursor"><b>|</b></div>
	</div><button class="button" onclick="start();">
	<p class="big_text">GO</p></button> 
</body>
</html>
